<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#163a36">
<title>Vacances CrÃ¨te 2026</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f0ece6;
    --card: #ffffff;
    --accent: #1a7a6d;
    --accent-hover: #145f55;
    --accent-light: #e8f5f2;
    --text: #1e2a2a;
    --text2: #6b7a78;
    --border: #ddd8d0;
    --sh-sm: 0 1px 4px rgba(30,42,42,0.04);
    --sh: 0 4px 16px rgba(30,42,42,0.06);
    --r: 14px;
    --meal-c: #d47a2e;
    --act-c: #2e78b5;
    --idea-c: #c9943e;
    --photo-c: #8b6aad;
    --note-c: #5a9e5c;
    --safe-b: env(safe-area-inset-bottom, 0px);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100dvh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
  }

  /* â•â•â•â•â•â•â•â• COVER â•â•â•â•â•â•â•â• */
  .cover {
    position: relative;
    width: 100%; height: 100dvh;
    overflow: hidden;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
  }

  .cover-img {
    position: absolute; inset: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    filter: brightness(0.5) saturate(1.2);
  }

  .cover-overlay {
    position: relative; z-index: 2;
    text-align: center; padding: 20px;
  }

  .cover-tag {
    display: inline-block;
    padding: 5px 16px;
    border: 1.5px solid rgba(255,255,255,0.3);
    border-radius: 30px;
    font-size: 0.68rem; font-weight: 600;
    letter-spacing: 2.5px; text-transform: uppercase;
    color: rgba(255,255,255,0.75);
    margin-bottom: 20px;
  }

  .cover h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.2rem, 8vw, 5rem);
    color: #fff; font-weight: 700;
    line-height: 1.1;
    text-shadow: 0 4px 30px rgba(0,0,0,0.3);
  }

  .cover h1 em { font-style: italic; font-weight: 400; color: rgba(255,255,255,0.85); }

  .cover-year {
    font-size: 1.1rem; font-weight: 600;
    color: rgba(255,255,255,0.5);
    margin-top: 14px; letter-spacing: 5px;
  }

  .cover-enter {
    position: absolute; bottom: max(32px, calc(20px + var(--safe-b)));
    left: 50%; transform: translateX(-50%);
    z-index: 3;
    padding: 14px 36px;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 50px;
    color: #fff;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem; font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    letter-spacing: 0.5px;
  }

  .cover-enter:active { background: rgba(255,255,255,0.25); }

  /* â•â•â•â•â•â•â•â• APP â•â•â•â•â•â•â•â• */
  .app { display: none; }
  .app.visible { display: block; }

  .header {
    background: linear-gradient(140deg, #163a36, #1e6058);
    padding: 20px 16px 14px;
    padding-top: max(20px, env(safe-area-inset-top, 20px));
    text-align: center;
    position: relative;
  }

  .header h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.25rem; color: #fff; font-weight: 700;
  }

  .header p { color: rgba(255,255,255,0.38); font-size: 0.75rem; margin-top: 2px; }

  .back-btn {
    position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
    background: rgba(255,255,255,0.1); border: none;
    color: rgba(255,255,255,0.7);
    width: 34px; height: 34px; border-radius: 10px;
    cursor: pointer; font-size: 1rem; z-index: 2;
    display: flex; align-items: center; justify-content: center;
  }

  .back-btn:active { background: rgba(255,255,255,0.2); }

  /* â•â•â•â•â•â•â•â• TABS â•â•â•â•â•â•â•â• */
  .tabs-wrap {
    position: sticky; top: 0; z-index: 50;
    background: var(--bg);
    border-bottom: 1.5px solid var(--border);
  }

  .tabs-scroll {
    display: flex; overflow-x: auto;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    scroll-snap-type: x proximity;
  }

  .tabs-scroll::-webkit-scrollbar { display: none; }

  .tab-btn {
    flex-shrink: 0;
    padding: 12px 18px;
    border: none; background: none;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.84rem; font-weight: 600;
    color: var(--text2); cursor: pointer;
    position: relative; transition: color 0.2s;
    white-space: nowrap;
    scroll-snap-align: center;
    min-width: 70px; text-align: center;
  }

  .tab-btn:active { color: var(--text); }
  .tab-btn.active { color: var(--accent); }

  .tab-btn.active::after {
    content: '';
    position: absolute; bottom: 0; left: 18%; right: 18%;
    height: 3px; background: var(--accent);
    border-radius: 3px 3px 0 0;
  }

  .tab-dot {
    display: inline-block;
    width: 5px; height: 5px; border-radius: 50%;
    background: var(--accent);
    margin-left: 4px; vertical-align: middle;
    opacity: 0; transition: opacity 0.3s;
  }

  .tab-dot.has-content { opacity: 1; }

  /* â•â•â•â•â•â•â•â• CONTENT â•â•â•â•â•â•â•â• */
  .day-content {
    display: none;
    padding: 16px 14px;
    padding-bottom: calc(80px + var(--safe-b));
    animation: fadeIn 0.25s ease;
  }

  .day-content.active { display: block; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

  /* Day nav */
  .day-nav {
    display: flex; justify-content: space-between;
    align-items: center; padding: 6px 0 8px;
  }

  .day-nav-btn {
    padding: 8px 14px;
    border: none; border-radius: 8px;
    background: var(--card);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.76rem; font-weight: 600;
    color: var(--accent); cursor: pointer;
    box-shadow: var(--sh-sm);
  }

  .day-nav-btn:active { background: var(--accent-light); }
  .day-nav-btn:disabled { opacity: 0.25; pointer-events: none; }

  .day-nav-label {
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem; font-weight: 700; color: var(--accent);
  }

  /* â•â•â•â•â•â•â•â• SECTIONS â•â•â•â•â•â•â•â• */
  .section { margin-bottom: 20px; }

  .section-header {
    display: flex; align-items: center;
    justify-content: space-between; margin-bottom: 10px;
  }

  .section-title {
    display: flex; align-items: center; gap: 8px;
    font-family: 'Playfair Display', serif;
    font-size: 1.08rem; font-weight: 700;
  }

  .section-icon {
    width: 32px; height: 32px; border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.95rem; flex-shrink: 0;
  }

  .s-meals .section-icon { background: rgba(212,122,46,0.1); }
  .s-acts .section-icon { background: rgba(46,120,181,0.1); }
  .s-ideas .section-icon { background: rgba(201,148,62,0.12); }
  .s-photos .section-icon { background: rgba(139,106,173,0.1); }
  .s-notes .section-icon { background: rgba(90,158,92,0.1); }

  .add-btn {
    padding: 8px 14px;
    border: 1.5px dashed var(--border);
    border-radius: 9px; background: none;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.78rem; font-weight: 600;
    color: var(--text2); cursor: pointer;
  }

  .add-btn:active { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }

  /* â•â•â•â•â•â•â•â• CARDS â•â•â•â•â•â•â•â• */
  .item-card {
    background: var(--card);
    border-radius: 11px; padding: 10px 10px;
    box-shadow: var(--sh-sm);
    display: flex; align-items: center;
    gap: 8px; margin-bottom: 6px;
    animation: slideIn 0.2s ease;
  }

  @keyframes slideIn { from { opacity: 0; transform: translateX(-8px); } to { opacity: 1; transform: translateX(0); } }

  .item-text {
    flex: 1; min-width: 0;
    border: none; background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem; color: var(--text);
    outline: none; padding: 4px 0;
  }

  .item-text::placeholder { color: #c0b8ae; }

  .del-btn {
    width: 34px; height: 34px;
    border-radius: 8px; border: none;
    background: transparent; color: #ccc;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.2rem; flex-shrink: 0;
  }

  .del-btn:active { background: #fff0f0; color: #c0392b; }

  .meal-sel {
    padding: 6px 20px 6px 8px;
    border: 1.5px solid var(--border);
    border-radius: 7px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.72rem; font-weight: 700;
    text-transform: uppercase;
    outline: none; cursor: pointer;
    background: var(--card); color: var(--meal-c);
    min-width: 78px; flex-shrink: 0;
    -webkit-appearance: none; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6' fill='%23999'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 6px center;
  }

  .act-time {
    width: 64px;
    border: 1.5px solid var(--border);
    border-radius: 7px; padding: 6px 4px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.8rem; font-weight: 600;
    color: var(--act-c); text-align: center;
    outline: none; flex-shrink: 0;
  }

  /* â•â•â•â•â•â•â•â• IDEA BOX â•â•â•â•â•â•â•â• */
  .idea-box {
    background: linear-gradient(135deg, #fdf8ef, #fef5e7);
    border: 1.5px solid #f0e4cc;
    border-radius: var(--r); padding: 14px;
    position: relative; overflow: hidden;
  }

  .idea-box::before {
    content: '';
    position: absolute; top: -20px; right: -20px;
    width: 70px; height: 70px;
    background: radial-gradient(circle, rgba(201,148,62,0.1), transparent 70%);
    border-radius: 50%;
  }

  .idea-header {
    display: flex; align-items: center; gap: 6px;
    margin-bottom: 10px;
    font-size: 0.74rem; font-weight: 700;
    color: var(--idea-c);
    text-transform: uppercase; letter-spacing: 0.8px;
  }

  .ideas-list { display: flex; flex-direction: column; gap: 5px; }

  .idea-item {
    display: flex; align-items: center; gap: 8px;
    padding: 9px 10px;
    background: rgba(255,255,255,0.7);
    border-radius: 9px;
    animation: slideIn 0.2s ease;
  }

  .idea-bullet {
    width: 7px; height: 7px; border-radius: 50%;
    background: var(--idea-c); opacity: 0.45; flex-shrink: 0;
  }

  .idea-input {
    flex: 1; min-width: 0;
    border: none; background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.86rem; color: var(--text); outline: none;
  }

  .idea-input::placeholder { color: #c8bba6; font-style: italic; }

  .add-idea-btn {
    margin-top: 8px; padding: 10px 12px;
    border: 1.5px dashed #e0d3b8;
    border-radius: 8px; background: none;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.78rem; font-weight: 600;
    color: var(--idea-c); cursor: pointer;
    width: 100%; text-align: center;
  }

  .add-idea-btn:active { background: rgba(201,148,62,0.08); }

  /* â•â•â•â•â•â•â•â• PHOTOS â•â•â•â•â•â•â•â• */
  .photos-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
  }

  .photo-upload-zone {
    aspect-ratio: 1;
    border: 2px dashed var(--border);
    border-radius: 11px;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 4px; cursor: pointer;
    background: rgba(255,255,255,0.4);
  }

  .photo-upload-zone:active { border-color: var(--photo-c); background: #f8f0fc; }
  .photo-upload-zone span:first-child { font-size: 1.4rem; opacity: 0.35; }
  .photo-upload-zone span:last-child { font-size: 0.68rem; color: var(--text2); font-weight: 500; }

  .photo-item {
    position: relative; aspect-ratio: 1;
    border-radius: 11px; overflow: hidden;
    box-shadow: var(--sh); animation: fadeIn 0.3s ease;
  }

  .photo-item img { width: 100%; height: 100%; object-fit: cover; }

  .photo-item .photo-del {
    position: absolute; top: 5px; right: 5px;
    width: 28px; height: 28px; border-radius: 50%;
    background: rgba(0,0,0,0.5); color: #fff;
    border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.85rem;
  }

  .photo-caption {
    position: absolute; bottom: 0; left: 0; right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.55));
    padding: 16px 6px 5px;
  }

  .photo-caption input {
    width: 100%; border: none; background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.68rem; color: #fff; outline: none;
  }

  .photo-caption input::placeholder { color: rgba(255,255,255,0.5); }

  /* â•â•â•â•â•â•â•â• NOTES â•â•â•â•â•â•â•â• */
  .notes-area {
    width: 100%; min-height: 80px;
    border: 1.5px solid var(--border);
    border-radius: 11px; padding: 12px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.86rem; color: var(--text);
    background: var(--card); resize: vertical;
    outline: none; box-shadow: var(--sh-sm);
    -webkit-appearance: none;
  }

  .notes-area:focus { border-color: var(--accent); }
  .notes-area::placeholder { color: #c0b8ae; }

  /* â•â•â•â•â•â•â•â• LIGHTBOX â•â•â•â•â•â•â•â• */
  .lightbox {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.92);
    z-index: 1000;
    display: none; align-items: center; justify-content: center;
  }

  .lightbox.show { display: flex; }

  .lightbox img {
    max-width: 95%; max-height: 88%;
    border-radius: 6px;
    box-shadow: 0 10px 50px rgba(0,0,0,0.5);
  }

  .lb-close {
    position: absolute;
    top: max(16px, env(safe-area-inset-top, 16px));
    right: 16px;
    width: 42px; height: 42px;
    border-radius: 50%;
    background: rgba(255,255,255,0.15);
    border: none; color: #fff;
    font-size: 1.4rem; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
  }

  .lb-close:active { background: rgba(255,255,255,0.3); }

  /* â•â•â•â•â•â•â•â• BOTTOM BAR â•â•â•â•â•â•â•â• */
  .bottom-bar {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: rgba(255,255,255,0.92);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-top: 1px solid var(--border);
    padding: 10px 12px;
    padding-bottom: max(10px, calc(var(--safe-b) + 6px));
    display: flex; justify-content: center;
    gap: 6px; z-index: 80;
  }

  .bb {
    padding: 11px 14px;
    border-radius: 10px; border: none;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.78rem; font-weight: 600;
    cursor: pointer; flex: 1; max-width: 130px;
    text-align: center;
  }

  .bb.pri { background: var(--accent); color: #fff; }
  .bb.pri:active { background: var(--accent-hover); }
  .bb.sec { background: var(--card); color: var(--text); border: 1.5px solid var(--border); }
  .bb.sec:active { border-color: var(--accent); color: var(--accent); }

  /* â•â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•â• */
  .toast {
    position: fixed; bottom: calc(72px + var(--safe-b));
    left: 50%; transform: translateX(-50%) translateY(30px);
    background: #1e2a2a; color: #fff;
    padding: 10px 22px; border-radius: 10px;
    font-size: 0.82rem; font-weight: 500;
    opacity: 0; transition: all 0.3s;
    z-index: 200; pointer-events: none;
    white-space: nowrap;
  }

  .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

  /* â•â•â•â•â•â•â•â• DESKTOP â•â•â•â•â•â•â•â• */
  @media (min-width: 768px) {
    .day-content { max-width: 720px; margin: 0 auto; padding: 22px 24px 90px; }
    .photos-grid { grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .bb { flex: 0; min-width: 120px; }
    .photo-item .photo-del { opacity: 0; transition: opacity 0.2s; }
    .photo-item:hover .photo-del { opacity: 1; }
  }

  @media (max-width: 380px) {
    .tab-btn { padding: 10px 13px; font-size: 0.78rem; }
    .bb { padding: 9px 8px; font-size: 0.72rem; }
    .photos-grid { grid-template-columns: repeat(2, 1fr); }
  }

  @media print {
    .cover, .bottom-bar, .tabs-wrap, .del-btn, .add-btn, .add-idea-btn,
    .photo-upload-zone, .photo-del, .back-btn, .day-nav { display: none !important; }
    .day-content { display: block !important; page-break-after: always; padding: 12px; }
    .app { display: block !important; }
    body { background: #fff; }
  }
</style>
</head>
<body>

<div class="cover" id="cover">
  <img class="cover-img" src="https://images.unsplash.com/photo-1570077188670-e3a8d69ac5ff?w=1600&q=85" alt="CrÃ¨te" />
  <div class="cover-overlay">
    <div class="cover-tag">Planning Vacances</div>
    <h1>Vacances <em>CrÃ¨te</em></h1>
    <div class="cover-year">â€” 2 0 2 6 â€”</div>
  </div>
  <button class="cover-enter" onclick="enterApp()">Ouvrir le planning â†’</button>
</div>

<div class="app" id="app">
  <div class="header">
    <button class="back-btn" onclick="showCover()">â†</button>
    <h2>Vacances CrÃ¨te 2026</h2>
    <p>8 jours &middot; Repas &middot; ActivitÃ©s &middot; IdÃ©es &middot; Photos</p>
  </div>
  <div class="tabs-wrap"><div class="tabs-scroll" id="tabs"></div></div>
  <div id="pages"></div>
  <div class="bottom-bar">
    <button class="bb pri" onclick="saveAll()">ğŸ’¾ Sauver</button>
    <button class="bb sec" onclick="exportAll()">ğŸ“‹ Export</button>
    <button class="bb sec" onclick="window.print()">ğŸ–¨ï¸</button>
    <button class="bb sec" style="color:#c0392b;" onclick="clearDay()">ğŸ—‘ï¸</button>
  </div>
</div>

<div class="lightbox" id="lightbox">
  <button class="lb-close" onclick="closeLB()">Ã—</button>
  <img id="lb-img" src="" alt="" />
</div>
<div class="toast" id="toast"></div>

<script>
const DAYS=8, MT=[
  {key:'petit-dej',label:'Petit-dÃ©j'},{key:'matin',label:'Matin'},
  {key:'midi',label:'Midi'},{key:'apres-midi',label:'AprÃ¨s-midi'},{key:'soiree',label:'SoirÃ©e'}
];
let cur=0;

function enterApp(){document.getElementById('cover').style.display='none';document.getElementById('app').classList.add('visible');}
function showCover(){document.getElementById('cover').style.display='';document.getElementById('app').classList.remove('visible');}

function buildUI(){
  const T=document.getElementById('tabs'),P=document.getElementById('pages');
  for(let d=0;d<DAYS;d++){
    const tab=document.createElement('button');
    tab.className='tab-btn'+(d===0?' active':'');
    tab.innerHTML=`Jour ${d+1} <span class="tab-dot" id="dot-${d}"></span>`;
    tab.onclick=()=>go(d);T.appendChild(tab);

    const p=document.createElement('div');
    p.className='day-content'+(d===0?' active':'');p.id=`page-${d}`;
    p.innerHTML=`
      <div class="day-nav">
        <button class="day-nav-btn" onclick="go(${d-1})" ${d===0?'disabled':''}>â† Jour ${d}</button>
        <span class="day-nav-label">Jour ${d+1}</span>
        <button class="day-nav-btn" onclick="go(${d+1})" ${d===DAYS-1?'disabled':''}>Jour ${d+2} â†’</button>
      </div>
      <div class="section s-meals"><div class="section-header"><div class="section-title"><div class="section-icon">ğŸ½ï¸</div> Repas</div><button class="add-btn" onclick="addMeal(${d})">+ Ajouter</button></div><div id="meals-${d}"></div></div>
      <div class="section s-acts"><div class="section-header"><div class="section-title"><div class="section-icon">ğŸ“‹</div> ActivitÃ©s</div><button class="add-btn" onclick="addAct(${d})">+ Ajouter</button></div><div id="acts-${d}"></div></div>
      <div class="section s-ideas"><div class="section-header"><div class="section-title"><div class="section-icon">ğŸ’¡</div> BoÃ®te Ã  idÃ©es</div></div><div class="idea-box"><div class="idea-header">ğŸ’¡ IdÃ©es, envies, Ã  tester...</div><div class="ideas-list" id="ideas-${d}"></div><button class="add-idea-btn" onclick="addIdea(${d})">+ Ajouter une idÃ©e</button></div></div>
      <div class="section s-photos"><div class="section-header"><div class="section-title"><div class="section-icon">ğŸ“·</div> Photos</div></div><div class="photos-grid" id="photos-${d}"><div class="photo-upload-zone" onclick="document.getElementById('file-${d}').click()"><span>ğŸ“¸</span><span>Ajouter</span></div></div><input type="file" id="file-${d}" accept="image/*" multiple hidden onchange="handleFiles(${d},this)" /></div>
      <div class="section s-notes"><div class="section-header"><div class="section-title"><div class="section-icon">ğŸ“</div> Notes</div></div><textarea class="notes-area" id="notes-${d}" placeholder="Notes, rappels..." oninput="upDots()"></textarea></div>
    `;P.appendChild(p);
  }
}

function go(d){
  if(d<0||d>=DAYS)return;cur=d;
  document.querySelectorAll('.tab-btn').forEach((t,i)=>t.classList.toggle('active',i===d));
  document.querySelectorAll('.day-content').forEach((p,i)=>p.classList.toggle('active',i===d));
  document.querySelectorAll('.tab-btn')[d].scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
  window.scrollTo({top:0,behavior:'smooth'});
}

// Swipe
let sx=0,sy=0;
document.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY;},{passive:true});
document.addEventListener('touchend',e=>{
  if(!document.getElementById('app').classList.contains('visible'))return;
  const dx=e.changedTouches[0].clientX-sx,dy=e.changedTouches[0].clientY-sy;
  if(Math.abs(dx)>60&&Math.abs(dx)>Math.abs(dy)*1.5){
    if(dx<0&&cur<DAYS-1)go(cur+1);
    if(dx>0&&cur>0)go(cur-1);
  }
},{passive:true});

function addMeal(d,type='petit-dej',text=''){
  const l=document.getElementById(`meals-${d}`),c=document.createElement('div');c.className='item-card';
  let o=MT.map(m=>`<option value="${m.key}" ${m.key===type?'selected':''}>${m.label}</option>`).join('');
  c.innerHTML=`<select class="meal-sel" onchange="upDots()">${o}</select><input type="text" class="item-text" placeholder="Qu'est-ce qu'on mange ?" value="${esc(text)}" oninput="upDots()"/><button class="del-btn" onclick="this.parentElement.remove();upDots();">Ã—</button>`;
  l.appendChild(c);if(!text)c.querySelector('.item-text').focus();upDots();
}

function addAct(d,time='',text=''){
  const l=document.getElementById(`acts-${d}`),c=document.createElement('div');c.className='item-card';
  c.innerHTML=`<input type="time" class="act-time" value="${time}" oninput="upDots()"/><input type="text" class="item-text" placeholder="ActivitÃ©, visite..." value="${esc(text)}" oninput="upDots()"/><button class="del-btn" onclick="this.parentElement.remove();upDots();">Ã—</button>`;
  l.appendChild(c);if(!text)c.querySelector('.item-text').focus();upDots();
}

function addIdea(d,text=''){
  const l=document.getElementById(`ideas-${d}`),i=document.createElement('div');i.className='idea-item';
  i.innerHTML=`<div class="idea-bullet"></div><input type="text" class="idea-input" placeholder="Resto, plage, excursion..." value="${esc(text)}" oninput="upDots()"/><button class="del-btn" onclick="this.parentElement.remove();upDots();">Ã—</button>`;
  l.appendChild(i);if(!text)i.querySelector('.idea-input').focus();upDots();
}

function handleFiles(d,input){
  for(const f of input.files){const r=new FileReader();r.onload=e=>addPhoto(d,e.target.result,'');r.readAsDataURL(f);}
  input.value='';
}

function addPhoto(d,src,cap){
  const g=document.getElementById(`photos-${d}`),i=document.createElement('div');i.className='photo-item';
  i.innerHTML=`<img src="${src}" onclick="openLB(this.src)"/><button class="photo-del" onclick="event.stopPropagation();this.parentElement.remove();upDots();">Ã—</button><div class="photo-caption"><input type="text" placeholder="LÃ©gende..." value="${esc(cap)}" oninput="upDots()"/></div>`;
  g.insertBefore(i,g.querySelector('.photo-upload-zone'));upDots();
}

function openLB(s){document.getElementById('lb-img').src=s;document.getElementById('lightbox').classList.add('show');}
function closeLB(){document.getElementById('lightbox').classList.remove('show');}
document.getElementById('lightbox').addEventListener('click',e=>{if(e.target===e.currentTarget)closeLB();});

function upDots(){
  for(let d=0;d<DAYS;d++){
    const has=document.querySelectorAll(`#meals-${d} .item-card`).length>0||document.querySelectorAll(`#acts-${d} .item-card`).length>0||document.querySelectorAll(`#ideas-${d} .idea-item`).length>0||document.querySelectorAll(`#photos-${d} .photo-item`).length>0||(document.getElementById(`notes-${d}`)?.value.trim().length>0);
    document.getElementById(`dot-${d}`).classList.toggle('has-content',has);
  }
}

function getData(){
  const data={};
  for(let d=0;d<DAYS;d++){
    data[d]={meals:[],acts:[],ideas:[],photos:[],notes:document.getElementById(`notes-${d}`).value};
    document.querySelectorAll(`#meals-${d} .item-card`).forEach(c=>{data[d].meals.push({type:c.querySelector('.meal-sel').value,text:c.querySelector('.item-text').value});});
    document.querySelectorAll(`#acts-${d} .item-card`).forEach(c=>{data[d].acts.push({time:c.querySelector('.act-time').value,text:c.querySelector('.item-text').value});});
    document.querySelectorAll(`#ideas-${d} .idea-item`).forEach(c=>{data[d].ideas.push(c.querySelector('.idea-input').value);});
    document.querySelectorAll(`#photos-${d} .photo-item`).forEach(c=>{data[d].photos.push({src:c.querySelector('img').src,cap:c.querySelector('.photo-caption input').value});});
  }return data;
}

function saveAll(){try{localStorage.setItem('crete26',JSON.stringify(getData()));toast('Planning sauvegardÃ© !');}catch(e){toast('Erreur (trop de photos ?)');}}

function loadAll(){
  try{
    const raw=localStorage.getItem('crete26');if(!raw)return;const data=JSON.parse(raw);
    for(let d=0;d<DAYS;d++){
      if(!data[d])continue;
      (data[d].meals||[]).forEach(m=>addMeal(d,m.type,m.text));
      (data[d].acts||[]).forEach(a=>addAct(d,a.time,a.text));
      (data[d].ideas||[]).forEach(t=>addIdea(d,t));
      (data[d].photos||[]).forEach(p=>addPhoto(d,p.src,p.cap));
      if(data[d].notes)document.getElementById(`notes-${d}`).value=data[d].notes;
    }
  }catch(e){}upDots();
}

function clearDay(){
  if(!confirm(`Vider tout le Jour ${cur+1} ?`))return;
  document.getElementById(`meals-${cur}`).innerHTML='';
  document.getElementById(`acts-${cur}`).innerHTML='';
  document.getElementById(`ideas-${cur}`).innerHTML='';
  document.querySelectorAll(`#photos-${cur} .photo-item`).forEach(i=>i.remove());
  document.getElementById(`notes-${cur}`).value='';
  upDots();toast(`Jour ${cur+1} vidÃ©`);
}

function exportAll(){
  const data=getData();
  let t='â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n       VACANCES CRÃˆTE 2026\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
  for(let d=0;d<DAYS;d++){
    t+=`â”â”â” JOUR ${d+1} â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;const dd=data[d];
    if(dd.meals.length){t+='ğŸ½ï¸ REPAS\n';dd.meals.forEach(m=>{const l=MT.find(x=>x.key===m.type)?.label||m.type;t+=`   ${l}: ${m.text||'(vide)'}\n`;});t+='\n';}
    if(dd.acts.length){t+='ğŸ“‹ ACTIVITÃ‰S\n';dd.acts.forEach(a=>t+=`   ${a.time||'--:--'}  ${a.text||'(vide)'}\n`);t+='\n';}
    if(dd.ideas.length){t+='ğŸ’¡ IDÃ‰ES\n';dd.ideas.forEach(i=>t+=`   â€¢ ${i||'(vide)'}\n`);t+='\n';}
    if(dd.notes.trim())t+=`ğŸ“ NOTES\n   ${dd.notes.trim()}\n\n`;t+='\n';
  }
  const blob=new Blob([t],{type:'text/plain;charset=utf-8'}),a=document.createElement('a');
  a.href=URL.createObjectURL(blob);a.download='vacances-crete-2026.txt';a.click();toast('Export terminÃ© !');
}

function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}

document.addEventListener('keydown',e=>{
  if(e.altKey&&e.key==='ArrowRight')go(Math.min(cur+1,DAYS-1));
  if(e.altKey&&e.key==='ArrowLeft')go(Math.max(cur-1,0));
});

buildUI();loadAll();
</script>
</body>
</html>
